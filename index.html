<html>
	<head>
		<style>

		  #card_overlay {
			position:relative;
			height: 750px;
			width: 497px;
		  }

		  
		  #card_image {
			position: absolute;
			max-height: 80%;
			max-width: 80%;
		  }
		 
		 .card_stats {
			position: absolute;
			font-family: EurostileLTStd;
			top:685px;
			font-size: 42pt;
			color:#000000;
			text-align:right;
		 }
		 
		 #output_range {
			right:382px
		 }

		 #output_nb_dice {
			right:274px
		 }
		 
		  #output_val_dice {
			right:167px
		 }

		  #output_power {
			right:60px
		 }
		 
		 #card_file {
			margin-top:10px
		 }
		 
		 .input_card_stats {
			width:24px;
		 }
		 
		 .calque{
		 	position:absolute;
		 }
		 
		 @font-face {
			font-family: EurostileLTStd;
			src: url("fonts/EurostileLTStd-BoldCn.otf") format("opentype");

		}

		  
		</style>

		<script src="libs/html2canvas.js"></script>
		<script>
		  function handleFileSelect(evt) {
			var files = evt.target.files; // FileList object

			// Loop through the FileList and render image files as thumbnails.
			for (var i = 0, f; f = files[i]; i++) {

			  // Only process image files.
			  if (!f.type.match('image.*')) {
				continue;
			  }

			  var reader = new FileReader();

			  // Closure to capture the file information.
			  reader.onload = (function(theFile) {
				return function(e) {
				  // Render thumbnail.
				  var card_image = document.getElementById("card_image");
				  card_image.src=e.target.result;
				  
				  card_image.style.left=(card_overlay.offsetWidth-card_image.offsetWidth)/2;
				  
				  update();
				};
			  })(f);

			  
			  // Read in the image file as a data URL.
			  reader.readAsDataURL(f);
			}
			

		  }
		  
		  function convert(){
				html2canvas(document.getElementById("card_overlay"), {
				onrendered: function(canvas) {
					document.getElementById("card_download").href=canvas.toDataURL('image/png');
				},
				logging:true
			});
			
		  }
		  
		  function update(){
			var range = document.getElementById("input_range").value;
			var nb_dices = document.getElementById("input_nb_dice").value;
			var val_dices = document.getElementById("input_val_dice").value;
			var power = document.getElementById("input_power").value;
			
			if(range!="" || nb_dices!="" || val_dices!="" || power!=""){
				document.getElementById("output_stats").style.display="block";
			} else {
				document.getElementById("output_stats").style.display="none";
			}
			
			document.getElementById("output_range").innerHTML=range;
			document.getElementById("output_nb_dice").innerHTML=nb_dices;
			document.getElementById("output_val_dice").innerHTML=val_dices;
			document.getElementById("output_power").innerHTML=power;
			
			
			if(document.getElementById("input_ultrared").checked){
				document.getElementById("output_ultrared").style.display="block";
			} else {
				document.getElementById("output_ultrared").style.display="none";
			}
			
			
			convert();
			
		  }

			window.onload = function(e){
				  var card_image = document.getElementById("card_image");
				  var card_overlay = document.getElementById("card_overlay");

				  document.getElementById('card_file').addEventListener('change', handleFileSelect, false);
				  document.getElementById('input_range').addEventListener('change', update, false);
				  document.getElementById('input_nb_dice').addEventListener('change', update, false);
				  document.getElementById('input_val_dice').addEventListener('change', update, false);
				  document.getElementById('input_power').addEventListener('change', update, false);
				  
				  document.getElementById("input_ultrared").addEventListener('change', update,false);
				  
				  update();
			  
			}
		  

		</script>	

	</head>
<body>

	<div id="card_overlay">
		<img src="img/ArrierePlan.png" id="card_background" class="calque"/>
		<img src="img/Stats.png" id="output_stats" class="calque"/>
		<img src="img/Ultrared.png" id="output_ultrared" class="calque"/>
		<img id="card_image" src=""/>
		<div id="output_range" class="card_stats"></div>
		<div id="output_nb_dice" class="card_stats"></div>
		<div id="output_val_dice" class="card_stats"></div>
		<div id="output_power" class="card_stats"></div>
	</div>

	<input type="file" id="card_file" name="files[]" multiple />
	<br/>
	<input id="input_range" type="text" class="input_card_stats" />
	<input id="input_nb_dice" type="text" class="input_card_stats" />
	<input id="input_val_dice" type="text" class="input_card_stats" >
	<input id="input_power" type="text" class="input_card_stats" />
	<br/>
	Ultrarouge ? <input type="checkbox" id="input_ultrared"/>
	<br/>
	<a id="card_download" download="card.png" href="">Download</a>
<br/>
</body>
</html>