<html>
	<head>
		<style>

		  #card_overlay {
			position:relative;
			height: 750px;
			width: 487px;
		  }

		  #output_dual{
			padding-top:8px;
			height: 60px;
			width: 60px;
		  }
		  
		  #card_image {
			position: absolute;
			max-height: 80%;
			max-width: 80%;
			top: 200px;
			cursor: move;
		  }
		 
		 .card_stats {
			position: absolute;
			font-family: EurostileLTStd;
			bottom: 25px;
			font-size: 30pt;
			color:#000000;
			text-align:right;
			line-height: 0.9em;
		 }
		 
		 
		 #output_range {
			right:365px
		 }

		 #output_nb_dice {
			right:260px
		 }
		 
		  #output_val_dice {
			right:150px
		 }

		  #output_power {
			right:45px
		 }
		 
		 #card_file {
			margin-top:10px
		 }
		 
		 .input_card_stats {
			width:24px;
		 }
		 
		 .calque{
		 	position:absolute;
		 }
		 
		 .calque_break_in_noise {
			right:0px;
			top: 150px;
			cursor: move;
		 }
		 
		 .calque_kill_noise{
		 	left:0px;
			top: 470;
			cursor: move;
		 }
		 
		 .optional {
			display:none;
		 }
		 
		 #output_card_header {
			position:absolute;
			width: 487px;
			top:30px;
			text-align:center;
		}
		

		 #output_card_header p{
			margin: 0;
		}
		
		 #output_card_name {
			font-family: Crackhouse;
			/* 89px -> 65pt */
			font-size: 65pt;
			color:#090808;
			line-height: 0.8em;

		 }

		 #output_card_sub_name {
			font-family: EurostileLTStd;
			/* 89px -> 65pt */
			font-size: 18pt;
			color:#5C5C5F;
		 }
		 
		 #output_description_container {
		 	position:absolute;
			/* 89px -> 65pt */
			font-size: 18pt;
			color:#5C5C5F;
			top: 545px;
			width: 420px;
			height: 205px;
			left: 35px;
		 }
		 
		#output_description_container  tr{
			height: 205px;
			vertical-align:middle;
		 }
		 
		 #output_description_container  tr td{
			font-family: EurostileLTStd;
			font-size: 18pt;
			color:#5C5C5F;
			text-align:center;
		 }
		 
		 @font-face {
			font-family: EurostileLTStd;
			src: url("fonts/EurostileLTStd-BoldCn.otf") format("opentype");
		}

		@font-face {
			font-family: Crackhouse;
			src: url('fonts/crackhouse.otf') format("opentype");
		}
		
		#input_dual_container tr {
			vertical-align: middle;
		}
		
		#input_dual_container img {
			width: 30px;
			height: 30px;
		}
		  
		</style>

		<script src="libs/html2canvas.js"></script>

		<script src="libs/jquery.js"></script>
		<script src="libs/jquery-ui.min.js"></script>
		
		<script>
		  function handleFileSelect(evt) {
			var files = evt.target.files; // FileList object

			// Loop through the FileList and render image files as thumbnails.
			for (var i = 0, f; f = files[i]; i++) {

			  // Only process image files.
			  if (!f.type.match('image.*')) {
				continue;
			  }

			  var reader = new FileReader();

			  // Closure to capture the file information.
			  reader.onload = (function(theFile) {
				return function(e) {
				  // Render thumbnail.
				  var card_image = document.getElementById("card_image");
				  card_image.src=e.target.result;
				  
				  card_image.style.left=(card_overlay.offsetWidth-card_image.offsetWidth)/2;
				  
				$( "#card_image" ).draggable({
					containment: "parent",
					axis: "y"
				});
				  
				  convert();
				};
			  })(f);

			  
			  // Read in the image file as a data URL.
			  reader.readAsDataURL(f);
			}
			

		  }
		  
		  function handleDualFileSelect(evt) {
			var files = evt.target.files; // FileList object

			// Loop through the FileList and render image files as thumbnails.
			for (var i = 0, f; f = files[i]; i++) {

			  // Only process image files.
			  if (!f.type.match('image.*')) {
				continue;
			  }

			  var reader = new FileReader();

			  // Closure to capture the file information.
			  reader.onload = (function(theFile) {
				return function(e) {
				  // Render thumbnail.
				  var dual_image = document.getElementById("output_dual");
				  dual_image.src=e.target.result;
				  
				  
				  convert();
				};
			  })(f);

			  
			  // Read in the image file as a data URL.
			  reader.readAsDataURL(f);
			}
			

		  }
		  
		  function convert(){
				html2canvas(document.getElementById("card_overlay"), {
				onrendered: function(canvas) {
					document.getElementById("card_download").href=canvas.toDataURL('image/png');
					

				},
				logging:false
			});
			
		  }
		  
		  function update_stats(){
			var range = document.getElementById("input_range").value.replace(/\r\n|\r|\n/g,"<br />");
			var nb_dices = document.getElementById("input_nb_dice").value.replace(/\r\n|\r|\n/g,"<br />");
			var val_dices = document.getElementById("input_val_dice").value.replace(/\r\n|\r|\n/g,"<br />");
			var power = document.getElementById("input_power").value.replace(/\r\n|\r|\n/g,"<br />");
			
			if(range!="" || nb_dices!="" || val_dices!="" || power!=""){
				document.getElementById("calque_stats").style.display="block";
				$("#input_description").prop('disabled', true);
			} else {
				document.getElementById("calque_stats").style.display="none";
				$("#input_description").prop('disabled', false);
			}
			
			document.getElementById("output_range").innerHTML=range;
			document.getElementById("output_nb_dice").innerHTML=nb_dices;
			document.getElementById("output_val_dice").innerHTML=val_dices;
			document.getElementById("output_power").innerHTML=power;

		  }
		  
		  function update_headers(){
		  		var card_name = document.getElementById("input_card_name").value.replace(/\r\n|\r|\n/g,"<br />");
				var card_sub_name = document.getElementById("input_card_sub_name").value.replace(/\r\n|\r|\n/g,"<br />");
				document.getElementById("output_card_name").innerHTML=card_name.toUpperCase();
				document.getElementById("output_card_sub_name").innerHTML=card_sub_name.toUpperCase();
		  }
		  
		  function update_description(){
			var description = document.getElementById("input_description").value;
			description = description.replace(/\r\n|\r|\n/g,"<br />");
			document.getElementById("output_description").innerHTML=description.toUpperCase();
			
			if(description){
				document.getElementById("calque_description").style.display="block";
				$(".input_card_stats").prop('disabled', true);
			} else {
				document.getElementById("calque_description").style.display="none";
				$(".input_card_stats").prop('disabled', false);
			}
			
		  }
		  
		  function update_ultrared(){
		  	if(document.getElementById("input_ultrared").checked){
				document.getElementById("calque_ultrared").style.display="block";
			} else {
				document.getElementById("calque_ultrared").style.display="none";
			}
			
			convert();
		  }
		  
		  function update_break_in_noise(){
		  
		  	if(document.getElementById("input_break_in_noisy").checked){
				document.getElementById("calque_noisy_break_in").style.display="block";
			} else {
				document.getElementById("calque_noisy_break_in").style.display="none";
			}
			

			if(document.getElementById("input_break_in_silent").checked){
				document.getElementById("calque_silent_break_in").style.display="block";
			} else {
				document.getElementById("calque_silent_break_in").style.display="none";
			}
			
			convert();
		  }

		function update_kill_noise(){
		  	if(document.getElementById("input_kill_noisy").checked){
				document.getElementById("calque_noisy_kill").style.display="block";
			} else {
				document.getElementById("calque_noisy_kill").style.display="none";
			}
			

			if(document.getElementById("input_kill_silent").checked){
				document.getElementById("calque_silent_kill").style.display="block";
			} else {
				document.getElementById("calque_silent_kill").style.display="none";
			}
			
			convert();
		}
		
		function update_dual_icon(){
		
			document.getElementById("input_dual_file").disabled=true;
		
			if(document.getElementById("input_dual_none").checked){
				document.getElementById("output_dual").style.display="none";
			} else {
				document.getElementById("output_dual").style.display="block";
				
				if(document.getElementById("input_dual_melee").checked){
					document.getElementById("output_dual").src="img/dual_melee.png"
				} else if(document.getElementById("input_dual_distance").checked){
					document.getElementById("output_dual").src="img/dual_distance.png"
				} else if(document.getElementById("input_dual_custom").checked){
					document.getElementById("output_dual").src=""
					document.getElementById("input_dual_file").disabled=false;
				} else{
					document.getElementById("output_dual").style.display="none";
				}
			}
		

		}
		  
			window.onload = function(e){
				  var card_image = document.getElementById("card_image");
				  var card_overlay = document.getElementById("card_overlay");
				  
				  document.getElementById('input_range').addEventListener('keyup', update_stats, false);
				  document.getElementById('input_nb_dice').addEventListener('keyup', update_stats, false);
				  document.getElementById('input_val_dice').addEventListener('keyup', update_stats, false);
				  document.getElementById('input_power').addEventListener('keyup', update_stats, false);
				  document.getElementById('input_card_name').addEventListener('keyup', update_headers, false);
				  document.getElementById('input_card_sub_name').addEventListener('keyup', update_headers, false);
				  document.getElementById('input_description').addEventListener('keyup', update_description, false);
				  
				  document.getElementById('input_range').addEventListener('change', convert, false);
				  document.getElementById('input_nb_dice').addEventListener('change', convert, false);
				  document.getElementById('input_val_dice').addEventListener('change', convert, false);
				  document.getElementById('input_power').addEventListener('change', convert, false);
				  document.getElementById('input_card_name').addEventListener('change', convert, false);
				  document.getElementById('input_card_sub_name').addEventListener('change', convert, false);
				  document.getElementById('input_description').addEventListener('change', convert, false);
				  
				  document.getElementById('card_file').addEventListener('change', handleFileSelect, false);
				  document.getElementById('input_dual_file').addEventListener('change', handleDualFileSelect, false);				  
				  
				  document.getElementById("input_ultrared").addEventListener('click', update_ultrared,false);
				  
				  $("input[name='input_dual']").click(update_dual_icon);
				  
				  document.getElementById("input_break_in_none").addEventListener('click', update_break_in_noise,false);
				  document.getElementById("input_break_in_noisy").addEventListener('click', update_break_in_noise,false);
				  document.getElementById("input_break_in_silent").addEventListener('click', update_break_in_noise,false);

				  document.getElementById("input_kill_none").addEventListener('click', update_kill_noise,false);
				  document.getElementById("input_kill_noisy").addEventListener('click', update_kill_noise,false);
				  document.getElementById("input_kill_silent").addEventListener('click', update_kill_noise,false);
				  
				$( ".calque_break_in_noise" ).draggable({
					containment: "parent",
					axis: "y"
				});
				
				$( ".calque_kill_noise" ).draggable({
					containment: "parent",
					axis: "y"
				});
			  
			}
			

		</script>	

	</head>
<body>
	<table>
		<tr>
			<td>
				<div id="card_overlay">
					<img src="img/ArrierePlan.png" id="card_background" class="calque"/>
					<img src="img/Stats.png" id="calque_stats" class="calque optional"/>
					<img src="img/Text.png" id="calque_description" class="calque optional"/>
					<img src="img/SilentKill.png" id="calque_silent_kill" class="calque optional calque_kill_noise"/>
					<img src="img/SilentBreakIn_mini.png" id="calque_silent_break_in" class="calque optional calque_break_in_noise"/>
					<img src="img/NoisyBreakIn_mini.png" id="calque_noisy_break_in" class="calque optional calque_break_in_noise"/>
					<img src="img/NoisyKill.png" id="calque_noisy_kill" class="calque optional calque_kill_noise"/>
					<img src="img/Ultrared.png" id="calque_ultrared" class="calque optional"/>
					<span id="output_card_header">
						<table style="margin:auto">
							<tr>
								<td style="vertical-align: top;"><img src="img/dual_melee.png" id="output_dual" class="optional"/></td>
								<td><p id="output_card_name" ></p></td>
							</tr>
						</table>
						<p id="output_card_sub_name" ></p>
					</span>
					<table id="output_description_container"><tr><td id="output_description"></td></tr></table>
					<div id="output_range" class="card_stats"></div>
					<div id="output_nb_dice" class="card_stats"></div>
					<div id="output_val_dice" class="card_stats"></div>
					<div id="output_power" class="card_stats"></div>
					<img id="card_image" src=""/>
					
				</div>
			</td>
			<td style="vertical-align:top;">

				<table border="0">
					<tr>
						<td>Titre:</td>
						<td><textarea id="input_card_name" rows="4" cols="50" ></textarea></td>
					</tr>
					<tr>
						<td>Sous-titre:</td>
						<td><textarea id="input_card_sub_name" rows="4" cols="50" ></textarea></td>
					</tr>
					<tr>
						<td colspan="2">
							<input type="file" id="card_file" name="files[]" />
						</td>
					</tr>
					<tr>
						<td>Stats:</td>
						<td>
								<textarea id="input_range" rows="3" cols="10" class="input_card_stats"></textarea>
								<textarea id="input_nb_dice" rows="3" cols="10" class="input_card_stats"></textarea>
								<textarea id="input_val_dice" rows="3" cols="10" class="input_card_stats"></textarea>
								<textarea id="input_power" rows="3" cols="10" class="input_card_stats"></textarea>
						</td>
					</tr>
					<tr>
						<td>Description:</td>
						<td><textarea id="input_description" rows="4" cols="50" ></textarea></td>
					</tr>
					<tr>
						<td>
							Ouverture de porte:
						</td>
						<td>
							<input id="input_break_in_none" type="radio" name="input_break_in_noise"  value="none" checked="checked">Non</input>
							<input id="input_break_in_silent" type="radio" name="input_break_in_noise"  value="silent">Silencieux</input>
							<input id="input_break_in_noisy" type="radio" name="input_break_in_noise"  value="noisy">Bruyant</input>
						</td>
					</tr>
					<tr>
						<td>
							Bruit arme:
						</td>
						<td>
							<input id="input_kill_none" type="radio" name="input_kill_noise"  value="none" checked="checked">Non</input>
							<input id="input_kill_silent" type="radio" name="input_kill_noise"  value="silent">Silencieux</input>
							<input id="input_kill_noisy" type="radio" name="input_kill_noise"  value="noisy">Bruyant</input>
						</td>
					</tr>
					
					<tr  valign="top">
						<td>Dual:</td>
						<td>
							<table id="input_dual_container">
								<tr >
									<td>
										<input id="input_dual_none" type="radio" name="input_dual"  value="no" checked="checked">Non</input>
									</td>
									<td>
										<p>|</p>
									</td>
									<td>
										<input id="input_dual_melee" type="radio" name="input_dual"  value="melee">Mélée</input>
									</td>
									<td>
										<img src="img/dual_melee.png"/>
									</td>
									<td>
										<p>|</p>
									</td>
									<td>
										<input id="input_dual_distance" type="radio" name="input_dual"  value="distance">Distance</input>
									</td>
									<td>
										<img src="img/dual_distance.png"/>
									</td>
									<td>
										<p>|</p>
									</td>
									<td>
										<input id="input_dual_custom" type="radio" name="input_dual"  value="custom">Personnalisé</input>
									</td>
									<td>
										<input type="file" id="input_dual_file" name="files[]" disabled/>
									</td>
								</tr>
							</table>
						</td>
					</tr>
					
					<tr>
						<td>Ultrarouge:</td>
						<td><input type="checkbox" id="input_ultrared"/></td>
					</tr>
				</table>
				
				
				<br/>


				<a id="card_download" download="card.png" href="">-> Télécharger ! <-</a>
			</td>
		</tr>
	</table>
<br/>
</body>
</html>